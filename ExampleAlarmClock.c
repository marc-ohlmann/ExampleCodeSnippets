/*

	Example C code snippets for an AVR ATmega128 microcontroller inside an alarm clock.

*/

// includes for compiler testing
#include <stdio.h>
#include <stdint.h>

/*
#include <avr/io.h>
#include <util/delay.h>
#include <avr/interrupt.h>
#include "hd44780.h"
#include "twi_master.h"
#include "uart_functions.h"
#include "lm73_functions.h"
#include "si4734.h"
*/


#define TRUE 1 
#define FALSE 0 

#define F_CPU 16000000UL // cpu speed in hertz 


// enum of bit indices corresponding to each button that is read from a register of button inputs
enum EButtonIndices
{
    //button index for changing the clock time
    set_clock_time,
    
    //button index for changing the alarm time
    set_alarm_time,
    
    //button index for setting the alarm mode
    set_alarm_mode,
  
    //button index for turning the alarm on / off
    toggle_alarm,
    
    //button index for turning snooze on / off
    toggle_snooze,
  
    //button index for turning the radio on / off
    toggle_radio,
    
    // button index for changing between standard (12:00 am/pm) and military time (24:00)
    toggle_hour_mode,
    
    // button index for changing between fahrenheit and celsius for temperature readings
    toggle_temperature_mode,
    
    // indicates the size of the enum
    EButtonIndices_Size
};

// global volatiles -- used by interrupts routines, so compiler must not optimize these away
volatile uint8_t alarm_flag = 0; //flag set when alarm is going off
volatile uint8_t snooze_flag = 0; //flag set when alarm is snoozed
volatile uint8_t clock_seconds = 0; //seconds for time of day


// function that calculates a resulting byte after clearing the given bit of a given byte
uint8_t clear_bit(uint8_t in_byte, uint8_t byte_index)
{
	return in_byte & ~(1 << byte_index);
}

// function that calculates a resulting byte after setting the given bit of a given byte
uint8_t set_bit(uint8_t in_byte, uint8_t byte_index)
{
	return in_byte | (1 << byte_index);
}


// function that calculates a resulting byte after toggling the given bit of a given byte
uint8_t toggle_bit(uint8_t in_byte, uint8_t byte_index)
{
	return in_byte ^ (1 << byte_index);
}


// function used to generate the body of the static lookup table for the static version of clear_bit
void generate_body_static_clear_bit()
{
    printf("\nstatic const int lookup_table[256][8] = {");
    for(int j = 0b00000000; j <= 0b11111111; j++)
    {
        printf("\n\t{");
        for(int i = 0; i < 8; i++)
        {
            printf("%d", clear_bit(j, i));
    
            if(i < 7)
            {
                printf(",");
            }
        }
        printf("}");
        if(j < 255)
        {
            printf(",");
        }
    }
    
    printf("\n};");
    
    return;
}


// function used to generate the body of the static lookup table for the static version of set_bit
void generate_body_static_set_bit()
{
    printf("\nstatic const int lookup_table[256][8] = {");
    for(int j = 0b00000000; j < 0b11111111; j++)
    {
        printf("\n\t{");
        for(int i = 0; i < 8; i++)
        {
            printf("%d", set_bit(j, i));
    
            if(i < 7)
            {
                printf(",");
            }
        }
        printf("}");
        if(j < 255)
        {
            printf(",");
        }
    }
    
    printf("\n};");
    
    return;
}


// function used to generate the body of the static lookup table for the static version of set_bit
void generate_body_static_toggle_bit()
{
    printf("\nstatic const int lookup_table[256][8] = {");
    for(int j = 0b00000000; j < 0b11111111; j++)
    {
        printf("\n\t{");
        for(int i = 0; i < 8; i++)
        {
            printf("%d", toggle_bit(j, i));
    
            if(i < 7)
            {
                printf(",");
            }
        }
        printf("}");
        if(j < 255)
        {
            printf(",");
        }
    }
    
    printf("\n};");
    
    return;
}


// static version of clear_bit which simply fetches the answer from a static lookup table
uint8_t static_clear_bit(uint8_t in_byte, uint8_t byte_index)
{
    if(byte_index > 7) return 0;
    
    static const int lookup_table[256][8] = {
        {0,0,0,0,0,0,0,0},
        {0,1,1,1,1,1,1,1},
        {2,0,2,2,2,2,2,2},
        {2,1,3,3,3,3,3,3},
        {4,4,0,4,4,4,4,4},
        {4,5,1,5,5,5,5,5},
        {6,4,2,6,6,6,6,6},
        {6,5,3,7,7,7,7,7},
        {8,8,8,0,8,8,8,8},
        {8,9,9,1,9,9,9,9},
        {10,8,10,2,10,10,10,10},
        {10,9,11,3,11,11,11,11},
        {12,12,8,4,12,12,12,12},
        {12,13,9,5,13,13,13,13},
        {14,12,10,6,14,14,14,14},
        {14,13,11,7,15,15,15,15},
        {16,16,16,16,0,16,16,16},
        {16,17,17,17,1,17,17,17},
        {18,16,18,18,2,18,18,18},
        {18,17,19,19,3,19,19,19},
        {20,20,16,20,4,20,20,20},
        {20,21,17,21,5,21,21,21},
        {22,20,18,22,6,22,22,22},
        {22,21,19,23,7,23,23,23},
        {24,24,24,16,8,24,24,24},
        {24,25,25,17,9,25,25,25},
        {26,24,26,18,10,26,26,26},
        {26,25,27,19,11,27,27,27},
        {28,28,24,20,12,28,28,28},
        {28,29,25,21,13,29,29,29},
        {30,28,26,22,14,30,30,30},
        {30,29,27,23,15,31,31,31},
        {32,32,32,32,32,0,32,32},
        {32,33,33,33,33,1,33,33},
        {34,32,34,34,34,2,34,34},
        {34,33,35,35,35,3,35,35},
        {36,36,32,36,36,4,36,36},
        {36,37,33,37,37,5,37,37},
        {38,36,34,38,38,6,38,38},
        {38,37,35,39,39,7,39,39},
        {40,40,40,32,40,8,40,40},
        {40,41,41,33,41,9,41,41},
        {42,40,42,34,42,10,42,42},
        {42,41,43,35,43,11,43,43},
        {44,44,40,36,44,12,44,44},
        {44,45,41,37,45,13,45,45},
        {46,44,42,38,46,14,46,46},
        {46,45,43,39,47,15,47,47},
        {48,48,48,48,32,16,48,48},
        {48,49,49,49,33,17,49,49},
        {50,48,50,50,34,18,50,50},
        {50,49,51,51,35,19,51,51},
        {52,52,48,52,36,20,52,52},
        {52,53,49,53,37,21,53,53},
        {54,52,50,54,38,22,54,54},
        {54,53,51,55,39,23,55,55},
        {56,56,56,48,40,24,56,56},
        {56,57,57,49,41,25,57,57},
        {58,56,58,50,42,26,58,58},
        {58,57,59,51,43,27,59,59},
        {60,60,56,52,44,28,60,60},
        {60,61,57,53,45,29,61,61},
        {62,60,58,54,46,30,62,62},
        {62,61,59,55,47,31,63,63},
        {64,64,64,64,64,64,0,64},
        {64,65,65,65,65,65,1,65},
        {66,64,66,66,66,66,2,66},
        {66,65,67,67,67,67,3,67},
        {68,68,64,68,68,68,4,68},
        {68,69,65,69,69,69,5,69},
        {70,68,66,70,70,70,6,70},
        {70,69,67,71,71,71,7,71},
        {72,72,72,64,72,72,8,72},
        {72,73,73,65,73,73,9,73},
        {74,72,74,66,74,74,10,74},
        {74,73,75,67,75,75,11,75},
        {76,76,72,68,76,76,12,76},
        {76,77,73,69,77,77,13,77},
        {78,76,74,70,78,78,14,78},
        {78,77,75,71,79,79,15,79},
        {80,80,80,80,64,80,16,80},
        {80,81,81,81,65,81,17,81},
        {82,80,82,82,66,82,18,82},
        {82,81,83,83,67,83,19,83},
        {84,84,80,84,68,84,20,84},
        {84,85,81,85,69,85,21,85},
        {86,84,82,86,70,86,22,86},
        {86,85,83,87,71,87,23,87},
        {88,88,88,80,72,88,24,88},
        {88,89,89,81,73,89,25,89},
        {90,88,90,82,74,90,26,90},
        {90,89,91,83,75,91,27,91},
        {92,92,88,84,76,92,28,92},
        {92,93,89,85,77,93,29,93},
        {94,92,90,86,78,94,30,94},
        {94,93,91,87,79,95,31,95},
        {96,96,96,96,96,64,32,96},
        {96,97,97,97,97,65,33,97},
        {98,96,98,98,98,66,34,98},
        {98,97,99,99,99,67,35,99},
        {100,100,96,100,100,68,36,100},
        {100,101,97,101,101,69,37,101},
        {102,100,98,102,102,70,38,102},
        {102,101,99,103,103,71,39,103},
        {104,104,104,96,104,72,40,104},
        {104,105,105,97,105,73,41,105},
        {106,104,106,98,106,74,42,106},
        {106,105,107,99,107,75,43,107},
        {108,108,104,100,108,76,44,108},
        {108,109,105,101,109,77,45,109},
        {110,108,106,102,110,78,46,110},
        {110,109,107,103,111,79,47,111},
        {112,112,112,112,96,80,48,112},
        {112,113,113,113,97,81,49,113},
        {114,112,114,114,98,82,50,114},
        {114,113,115,115,99,83,51,115},
        {116,116,112,116,100,84,52,116},
        {116,117,113,117,101,85,53,117},
        {118,116,114,118,102,86,54,118},
        {118,117,115,119,103,87,55,119},
        {120,120,120,112,104,88,56,120},
        {120,121,121,113,105,89,57,121},
        {122,120,122,114,106,90,58,122},
        {122,121,123,115,107,91,59,123},
        {124,124,120,116,108,92,60,124},
        {124,125,121,117,109,93,61,125},
        {126,124,122,118,110,94,62,126},
        {126,125,123,119,111,95,63,127},
        {128,128,128,128,128,128,128,0},
        {128,129,129,129,129,129,129,1},
        {130,128,130,130,130,130,130,2},
        {130,129,131,131,131,131,131,3},
        {132,132,128,132,132,132,132,4},
        {132,133,129,133,133,133,133,5},
        {134,132,130,134,134,134,134,6},
        {134,133,131,135,135,135,135,7},
        {136,136,136,128,136,136,136,8},
        {136,137,137,129,137,137,137,9},
        {138,136,138,130,138,138,138,10},
        {138,137,139,131,139,139,139,11},
        {140,140,136,132,140,140,140,12},
        {140,141,137,133,141,141,141,13},
        {142,140,138,134,142,142,142,14},
        {142,141,139,135,143,143,143,15},
        {144,144,144,144,128,144,144,16},
        {144,145,145,145,129,145,145,17},
        {146,144,146,146,130,146,146,18},
        {146,145,147,147,131,147,147,19},
        {148,148,144,148,132,148,148,20},
        {148,149,145,149,133,149,149,21},
        {150,148,146,150,134,150,150,22},
        {150,149,147,151,135,151,151,23},
        {152,152,152,144,136,152,152,24},
        {152,153,153,145,137,153,153,25},
        {154,152,154,146,138,154,154,26},
        {154,153,155,147,139,155,155,27},
        {156,156,152,148,140,156,156,28},
        {156,157,153,149,141,157,157,29},
        {158,156,154,150,142,158,158,30},
        {158,157,155,151,143,159,159,31},
        {160,160,160,160,160,128,160,32},
        {160,161,161,161,161,129,161,33},
        {162,160,162,162,162,130,162,34},
        {162,161,163,163,163,131,163,35},
        {164,164,160,164,164,132,164,36},
        {164,165,161,165,165,133,165,37},
        {166,164,162,166,166,134,166,38},
        {166,165,163,167,167,135,167,39},
        {168,168,168,160,168,136,168,40},
        {168,169,169,161,169,137,169,41},
        {170,168,170,162,170,138,170,42},
        {170,169,171,163,171,139,171,43},
        {172,172,168,164,172,140,172,44},
        {172,173,169,165,173,141,173,45},
        {174,172,170,166,174,142,174,46},
        {174,173,171,167,175,143,175,47},
        {176,176,176,176,160,144,176,48},
        {176,177,177,177,161,145,177,49},
        {178,176,178,178,162,146,178,50},
        {178,177,179,179,163,147,179,51},
        {180,180,176,180,164,148,180,52},
        {180,181,177,181,165,149,181,53},
        {182,180,178,182,166,150,182,54},
        {182,181,179,183,167,151,183,55},
        {184,184,184,176,168,152,184,56},
        {184,185,185,177,169,153,185,57},
        {186,184,186,178,170,154,186,58},
        {186,185,187,179,171,155,187,59},
        {188,188,184,180,172,156,188,60},
        {188,189,185,181,173,157,189,61},
        {190,188,186,182,174,158,190,62},
        {190,189,187,183,175,159,191,63},
        {192,192,192,192,192,192,128,64},
        {192,193,193,193,193,193,129,65},
        {194,192,194,194,194,194,130,66},
        {194,193,195,195,195,195,131,67},
        {196,196,192,196,196,196,132,68},
        {196,197,193,197,197,197,133,69},
        {198,196,194,198,198,198,134,70},
        {198,197,195,199,199,199,135,71},
        {200,200,200,192,200,200,136,72},
        {200,201,201,193,201,201,137,73},
        {202,200,202,194,202,202,138,74},
        {202,201,203,195,203,203,139,75},
        {204,204,200,196,204,204,140,76},
        {204,205,201,197,205,205,141,77},
        {206,204,202,198,206,206,142,78},
        {206,205,203,199,207,207,143,79},
        {208,208,208,208,192,208,144,80},
        {208,209,209,209,193,209,145,81},
        {210,208,210,210,194,210,146,82},
        {210,209,211,211,195,211,147,83},
        {212,212,208,212,196,212,148,84},
        {212,213,209,213,197,213,149,85},
        {214,212,210,214,198,214,150,86},
        {214,213,211,215,199,215,151,87},
        {216,216,216,208,200,216,152,88},
        {216,217,217,209,201,217,153,89},
        {218,216,218,210,202,218,154,90},
        {218,217,219,211,203,219,155,91},
        {220,220,216,212,204,220,156,92},
        {220,221,217,213,205,221,157,93},
        {222,220,218,214,206,222,158,94},
        {222,221,219,215,207,223,159,95},
        {224,224,224,224,224,192,160,96},
        {224,225,225,225,225,193,161,97},
        {226,224,226,226,226,194,162,98},
        {226,225,227,227,227,195,163,99},
        {228,228,224,228,228,196,164,100},
        {228,229,225,229,229,197,165,101},
        {230,228,226,230,230,198,166,102},
        {230,229,227,231,231,199,167,103},
        {232,232,232,224,232,200,168,104},
        {232,233,233,225,233,201,169,105},
        {234,232,234,226,234,202,170,106},
        {234,233,235,227,235,203,171,107},
        {236,236,232,228,236,204,172,108},
        {236,237,233,229,237,205,173,109},
        {238,236,234,230,238,206,174,110},
        {238,237,235,231,239,207,175,111},
        {240,240,240,240,224,208,176,112},
        {240,241,241,241,225,209,177,113},
        {242,240,242,242,226,210,178,114},
        {242,241,243,243,227,211,179,115},
        {244,244,240,244,228,212,180,116},
        {244,245,241,245,229,213,181,117},
        {246,244,242,246,230,214,182,118},
        {246,245,243,247,231,215,183,119},
        {248,248,248,240,232,216,184,120},
        {248,249,249,241,233,217,185,121},
        {250,248,250,242,234,218,186,122},
        {250,249,251,243,235,219,187,123},
        {252,252,248,244,236,220,188,124},
        {252,253,249,245,237,221,189,125},
        {254,252,250,246,238,222,190,126},
        {254,253,251,247,239,223,191,127}
    };
    
    
    return lookup_table[in_byte][byte_index];
}


// static version of set_bit which simply fetches the answer from a static table
uint8_t static_set_bit(uint8_t in_byte, uint8_t byte_index)
{
    if(byte_index > 7) return 0;
    
    static const int lookup_table[256][8] = {
        {1,2,4,8,16,32,64,128},
        {1,3,5,9,17,33,65,129},
        {3,2,6,10,18,34,66,130},
        {3,3,7,11,19,35,67,131},
        {5,6,4,12,20,36,68,132},
        {5,7,5,13,21,37,69,133},
        {7,6,6,14,22,38,70,134},
        {7,7,7,15,23,39,71,135},
        {9,10,12,8,24,40,72,136},
        {9,11,13,9,25,41,73,137},
        {11,10,14,10,26,42,74,138},
        {11,11,15,11,27,43,75,139},
        {13,14,12,12,28,44,76,140},
        {13,15,13,13,29,45,77,141},
        {15,14,14,14,30,46,78,142},
        {15,15,15,15,31,47,79,143},
        {17,18,20,24,16,48,80,144},
        {17,19,21,25,17,49,81,145},
        {19,18,22,26,18,50,82,146},
        {19,19,23,27,19,51,83,147},
        {21,22,20,28,20,52,84,148},
        {21,23,21,29,21,53,85,149},
        {23,22,22,30,22,54,86,150},
        {23,23,23,31,23,55,87,151},
        {25,26,28,24,24,56,88,152},
        {25,27,29,25,25,57,89,153},
        {27,26,30,26,26,58,90,154},
        {27,27,31,27,27,59,91,155},
        {29,30,28,28,28,60,92,156},
        {29,31,29,29,29,61,93,157},
        {31,30,30,30,30,62,94,158},
        {31,31,31,31,31,63,95,159},
        {33,34,36,40,48,32,96,160},
        {33,35,37,41,49,33,97,161},
        {35,34,38,42,50,34,98,162},
        {35,35,39,43,51,35,99,163},
        {37,38,36,44,52,36,100,164},
        {37,39,37,45,53,37,101,165},
        {39,38,38,46,54,38,102,166},
        {39,39,39,47,55,39,103,167},
        {41,42,44,40,56,40,104,168},
        {41,43,45,41,57,41,105,169},
        {43,42,46,42,58,42,106,170},
        {43,43,47,43,59,43,107,171},
        {45,46,44,44,60,44,108,172},
        {45,47,45,45,61,45,109,173},
        {47,46,46,46,62,46,110,174},
        {47,47,47,47,63,47,111,175},
        {49,50,52,56,48,48,112,176},
        {49,51,53,57,49,49,113,177},
        {51,50,54,58,50,50,114,178},
        {51,51,55,59,51,51,115,179},
        {53,54,52,60,52,52,116,180},
        {53,55,53,61,53,53,117,181},
        {55,54,54,62,54,54,118,182},
        {55,55,55,63,55,55,119,183},
        {57,58,60,56,56,56,120,184},
        {57,59,61,57,57,57,121,185},
        {59,58,62,58,58,58,122,186},
        {59,59,63,59,59,59,123,187},
        {61,62,60,60,60,60,124,188},
        {61,63,61,61,61,61,125,189},
        {63,62,62,62,62,62,126,190},
        {63,63,63,63,63,63,127,191},
        {65,66,68,72,80,96,64,192},
        {65,67,69,73,81,97,65,193},
        {67,66,70,74,82,98,66,194},
        {67,67,71,75,83,99,67,195},
        {69,70,68,76,84,100,68,196},
        {69,71,69,77,85,101,69,197},
        {71,70,70,78,86,102,70,198},
        {71,71,71,79,87,103,71,199},
        {73,74,76,72,88,104,72,200},
        {73,75,77,73,89,105,73,201},
        {75,74,78,74,90,106,74,202},
        {75,75,79,75,91,107,75,203},
        {77,78,76,76,92,108,76,204},
        {77,79,77,77,93,109,77,205},
        {79,78,78,78,94,110,78,206},
        {79,79,79,79,95,111,79,207},
        {81,82,84,88,80,112,80,208},
        {81,83,85,89,81,113,81,209},
        {83,82,86,90,82,114,82,210},
        {83,83,87,91,83,115,83,211},
        {85,86,84,92,84,116,84,212},
        {85,87,85,93,85,117,85,213},
        {87,86,86,94,86,118,86,214},
        {87,87,87,95,87,119,87,215},
        {89,90,92,88,88,120,88,216},
        {89,91,93,89,89,121,89,217},
        {91,90,94,90,90,122,90,218},
        {91,91,95,91,91,123,91,219},
        {93,94,92,92,92,124,92,220},
        {93,95,93,93,93,125,93,221},
        {95,94,94,94,94,126,94,222},
        {95,95,95,95,95,127,95,223},
        {97,98,100,104,112,96,96,224},
        {97,99,101,105,113,97,97,225},
        {99,98,102,106,114,98,98,226},
        {99,99,103,107,115,99,99,227},
        {101,102,100,108,116,100,100,228},
        {101,103,101,109,117,101,101,229},
        {103,102,102,110,118,102,102,230},
        {103,103,103,111,119,103,103,231},
        {105,106,108,104,120,104,104,232},
        {105,107,109,105,121,105,105,233},
        {107,106,110,106,122,106,106,234},
        {107,107,111,107,123,107,107,235},
        {109,110,108,108,124,108,108,236},
        {109,111,109,109,125,109,109,237},
        {111,110,110,110,126,110,110,238},
        {111,111,111,111,127,111,111,239},
        {113,114,116,120,112,112,112,240},
        {113,115,117,121,113,113,113,241},
        {115,114,118,122,114,114,114,242},
        {115,115,119,123,115,115,115,243},
        {117,118,116,124,116,116,116,244},
        {117,119,117,125,117,117,117,245},
        {119,118,118,126,118,118,118,246},
        {119,119,119,127,119,119,119,247},
        {121,122,124,120,120,120,120,248},
        {121,123,125,121,121,121,121,249},
        {123,122,126,122,122,122,122,250},
        {123,123,127,123,123,123,123,251},
        {125,126,124,124,124,124,124,252},
        {125,127,125,125,125,125,125,253},
        {127,126,126,126,126,126,126,254},
        {127,127,127,127,127,127,127,255},
        {129,130,132,136,144,160,192,128},
        {129,131,133,137,145,161,193,129},
        {131,130,134,138,146,162,194,130},
        {131,131,135,139,147,163,195,131},
        {133,134,132,140,148,164,196,132},
        {133,135,133,141,149,165,197,133},
        {135,134,134,142,150,166,198,134},
        {135,135,135,143,151,167,199,135},
        {137,138,140,136,152,168,200,136},
        {137,139,141,137,153,169,201,137},
        {139,138,142,138,154,170,202,138},
        {139,139,143,139,155,171,203,139},
        {141,142,140,140,156,172,204,140},
        {141,143,141,141,157,173,205,141},
        {143,142,142,142,158,174,206,142},
        {143,143,143,143,159,175,207,143},
        {145,146,148,152,144,176,208,144},
        {145,147,149,153,145,177,209,145},
        {147,146,150,154,146,178,210,146},
        {147,147,151,155,147,179,211,147},
        {149,150,148,156,148,180,212,148},
        {149,151,149,157,149,181,213,149},
        {151,150,150,158,150,182,214,150},
        {151,151,151,159,151,183,215,151},
        {153,154,156,152,152,184,216,152},
        {153,155,157,153,153,185,217,153},
        {155,154,158,154,154,186,218,154},
        {155,155,159,155,155,187,219,155},
        {157,158,156,156,156,188,220,156},
        {157,159,157,157,157,189,221,157},
        {159,158,158,158,158,190,222,158},
        {159,159,159,159,159,191,223,159},
        {161,162,164,168,176,160,224,160},
        {161,163,165,169,177,161,225,161},
        {163,162,166,170,178,162,226,162},
        {163,163,167,171,179,163,227,163},
        {165,166,164,172,180,164,228,164},
        {165,167,165,173,181,165,229,165},
        {167,166,166,174,182,166,230,166},
        {167,167,167,175,183,167,231,167},
        {169,170,172,168,184,168,232,168},
        {169,171,173,169,185,169,233,169},
        {171,170,174,170,186,170,234,170},
        {171,171,175,171,187,171,235,171},
        {173,174,172,172,188,172,236,172},
        {173,175,173,173,189,173,237,173},
        {175,174,174,174,190,174,238,174},
        {175,175,175,175,191,175,239,175},
        {177,178,180,184,176,176,240,176},
        {177,179,181,185,177,177,241,177},
        {179,178,182,186,178,178,242,178},
        {179,179,183,187,179,179,243,179},
        {181,182,180,188,180,180,244,180},
        {181,183,181,189,181,181,245,181},
        {183,182,182,190,182,182,246,182},
        {183,183,183,191,183,183,247,183},
        {185,186,188,184,184,184,248,184},
        {185,187,189,185,185,185,249,185},
        {187,186,190,186,186,186,250,186},
        {187,187,191,187,187,187,251,187},
        {189,190,188,188,188,188,252,188},
        {189,191,189,189,189,189,253,189},
        {191,190,190,190,190,190,254,190},
        {191,191,191,191,191,191,255,191},
        {193,194,196,200,208,224,192,192},
        {193,195,197,201,209,225,193,193},
        {195,194,198,202,210,226,194,194},
        {195,195,199,203,211,227,195,195},
        {197,198,196,204,212,228,196,196},
        {197,199,197,205,213,229,197,197},
        {199,198,198,206,214,230,198,198},
        {199,199,199,207,215,231,199,199},
        {201,202,204,200,216,232,200,200},
        {201,203,205,201,217,233,201,201},
        {203,202,206,202,218,234,202,202},
        {203,203,207,203,219,235,203,203},
        {205,206,204,204,220,236,204,204},
        {205,207,205,205,221,237,205,205},
        {207,206,206,206,222,238,206,206},
        {207,207,207,207,223,239,207,207},
        {209,210,212,216,208,240,208,208},
        {209,211,213,217,209,241,209,209},
        {211,210,214,218,210,242,210,210},
        {211,211,215,219,211,243,211,211},
        {213,214,212,220,212,244,212,212},
        {213,215,213,221,213,245,213,213},
        {215,214,214,222,214,246,214,214},
        {215,215,215,223,215,247,215,215},
        {217,218,220,216,216,248,216,216},
        {217,219,221,217,217,249,217,217},
        {219,218,222,218,218,250,218,218},
        {219,219,223,219,219,251,219,219},
        {221,222,220,220,220,252,220,220},
        {221,223,221,221,221,253,221,221},
        {223,222,222,222,222,254,222,222},
        {223,223,223,223,223,255,223,223},
        {225,226,228,232,240,224,224,224},
        {225,227,229,233,241,225,225,225},
        {227,226,230,234,242,226,226,226},
        {227,227,231,235,243,227,227,227},
        {229,230,228,236,244,228,228,228},
        {229,231,229,237,245,229,229,229},
        {231,230,230,238,246,230,230,230},
        {231,231,231,239,247,231,231,231},
        {233,234,236,232,248,232,232,232},
        {233,235,237,233,249,233,233,233},
        {235,234,238,234,250,234,234,234},
        {235,235,239,235,251,235,235,235},
        {237,238,236,236,252,236,236,236},
        {237,239,237,237,253,237,237,237},
        {239,238,238,238,254,238,238,238},
        {239,239,239,239,255,239,239,239},
        {241,242,244,248,240,240,240,240},
        {241,243,245,249,241,241,241,241},
        {243,242,246,250,242,242,242,242},
        {243,243,247,251,243,243,243,243},
        {245,246,244,252,244,244,244,244},
        {245,247,245,253,245,245,245,245},
        {247,246,246,254,246,246,246,246},
        {247,247,247,255,247,247,247,247},
        {249,250,252,248,248,248,248,248},
        {249,251,253,249,249,249,249,249},
        {251,250,254,250,250,250,250,250},
        {251,251,255,251,251,251,251,251},
        {253,254,252,252,252,252,252,252},
        {253,255,253,253,253,253,253,253},
        {255,254,254,254,254,254,254,254},
    };
    
    
    return lookup_table[in_byte][byte_index];
}


// static version of toggle_bit which simply fetches the answer from a static table
uint8_t static_toggle_bit(uint8_t in_byte, uint8_t byte_index)
{
    if(byte_index > 7) return 0;
    
    static const int lookup_table[256][8] = {
        {1,2,4,8,16,32,64,128},
        {0,3,5,9,17,33,65,129},
        {3,0,6,10,18,34,66,130},
        {2,1,7,11,19,35,67,131},
        {5,6,0,12,20,36,68,132},
        {4,7,1,13,21,37,69,133},
        {7,4,2,14,22,38,70,134},
        {6,5,3,15,23,39,71,135},
        {9,10,12,0,24,40,72,136},
        {8,11,13,1,25,41,73,137},
        {11,8,14,2,26,42,74,138},
        {10,9,15,3,27,43,75,139},
        {13,14,8,4,28,44,76,140},
        {12,15,9,5,29,45,77,141},
        {15,12,10,6,30,46,78,142},
        {14,13,11,7,31,47,79,143},
        {17,18,20,24,0,48,80,144},
        {16,19,21,25,1,49,81,145},
        {19,16,22,26,2,50,82,146},
        {18,17,23,27,3,51,83,147},
        {21,22,16,28,4,52,84,148},
        {20,23,17,29,5,53,85,149},
        {23,20,18,30,6,54,86,150},
        {22,21,19,31,7,55,87,151},
        {25,26,28,16,8,56,88,152},
        {24,27,29,17,9,57,89,153},
        {27,24,30,18,10,58,90,154},
        {26,25,31,19,11,59,91,155},
        {29,30,24,20,12,60,92,156},
        {28,31,25,21,13,61,93,157},
        {31,28,26,22,14,62,94,158},
        {30,29,27,23,15,63,95,159},
        {33,34,36,40,48,0,96,160},
        {32,35,37,41,49,1,97,161},
        {35,32,38,42,50,2,98,162},
        {34,33,39,43,51,3,99,163},
        {37,38,32,44,52,4,100,164},
        {36,39,33,45,53,5,101,165},
        {39,36,34,46,54,6,102,166},
        {38,37,35,47,55,7,103,167},
        {41,42,44,32,56,8,104,168},
        {40,43,45,33,57,9,105,169},
        {43,40,46,34,58,10,106,170},
        {42,41,47,35,59,11,107,171},
        {45,46,40,36,60,12,108,172},
        {44,47,41,37,61,13,109,173},
        {47,44,42,38,62,14,110,174},
        {46,45,43,39,63,15,111,175},
        {49,50,52,56,32,16,112,176},
        {48,51,53,57,33,17,113,177},
        {51,48,54,58,34,18,114,178},
        {50,49,55,59,35,19,115,179},
        {53,54,48,60,36,20,116,180},
        {52,55,49,61,37,21,117,181},
        {55,52,50,62,38,22,118,182},
        {54,53,51,63,39,23,119,183},
        {57,58,60,48,40,24,120,184},
        {56,59,61,49,41,25,121,185},
        {59,56,62,50,42,26,122,186},
        {58,57,63,51,43,27,123,187},
        {61,62,56,52,44,28,124,188},
        {60,63,57,53,45,29,125,189},
        {63,60,58,54,46,30,126,190},
        {62,61,59,55,47,31,127,191},
        {65,66,68,72,80,96,0,192},
        {64,67,69,73,81,97,1,193},
        {67,64,70,74,82,98,2,194},
        {66,65,71,75,83,99,3,195},
        {69,70,64,76,84,100,4,196},
        {68,71,65,77,85,101,5,197},
        {71,68,66,78,86,102,6,198},
        {70,69,67,79,87,103,7,199},
        {73,74,76,64,88,104,8,200},
        {72,75,77,65,89,105,9,201},
        {75,72,78,66,90,106,10,202},
        {74,73,79,67,91,107,11,203},
        {77,78,72,68,92,108,12,204},
        {76,79,73,69,93,109,13,205},
        {79,76,74,70,94,110,14,206},
        {78,77,75,71,95,111,15,207},
        {81,82,84,88,64,112,16,208},
        {80,83,85,89,65,113,17,209},
        {83,80,86,90,66,114,18,210},
        {82,81,87,91,67,115,19,211},
        {85,86,80,92,68,116,20,212},
        {84,87,81,93,69,117,21,213},
        {87,84,82,94,70,118,22,214},
        {86,85,83,95,71,119,23,215},
        {89,90,92,80,72,120,24,216},
        {88,91,93,81,73,121,25,217},
        {91,88,94,82,74,122,26,218},
        {90,89,95,83,75,123,27,219},
        {93,94,88,84,76,124,28,220},
        {92,95,89,85,77,125,29,221},
        {95,92,90,86,78,126,30,222},
        {94,93,91,87,79,127,31,223},
        {97,98,100,104,112,64,32,224},
        {96,99,101,105,113,65,33,225},
        {99,96,102,106,114,66,34,226},
        {98,97,103,107,115,67,35,227},
        {101,102,96,108,116,68,36,228},
        {100,103,97,109,117,69,37,229},
        {103,100,98,110,118,70,38,230},
        {102,101,99,111,119,71,39,231},
        {105,106,108,96,120,72,40,232},
        {104,107,109,97,121,73,41,233},
        {107,104,110,98,122,74,42,234},
        {106,105,111,99,123,75,43,235},
        {109,110,104,100,124,76,44,236},
        {108,111,105,101,125,77,45,237},
        {111,108,106,102,126,78,46,238},
        {110,109,107,103,127,79,47,239},
        {113,114,116,120,96,80,48,240},
        {112,115,117,121,97,81,49,241},
        {115,112,118,122,98,82,50,242},
        {114,113,119,123,99,83,51,243},
        {117,118,112,124,100,84,52,244},
        {116,119,113,125,101,85,53,245},
        {119,116,114,126,102,86,54,246},
        {118,117,115,127,103,87,55,247},
        {121,122,124,112,104,88,56,248},
        {120,123,125,113,105,89,57,249},
        {123,120,126,114,106,90,58,250},
        {122,121,127,115,107,91,59,251},
        {125,126,120,116,108,92,60,252},
        {124,127,121,117,109,93,61,253},
        {127,124,122,118,110,94,62,254},
        {126,125,123,119,111,95,63,255},
        {129,130,132,136,144,160,192,0},
        {128,131,133,137,145,161,193,1},
        {131,128,134,138,146,162,194,2},
        {130,129,135,139,147,163,195,3},
        {133,134,128,140,148,164,196,4},
        {132,135,129,141,149,165,197,5},
        {135,132,130,142,150,166,198,6},
        {134,133,131,143,151,167,199,7},
        {137,138,140,128,152,168,200,8},
        {136,139,141,129,153,169,201,9},
        {139,136,142,130,154,170,202,10},
        {138,137,143,131,155,171,203,11},
        {141,142,136,132,156,172,204,12},
        {140,143,137,133,157,173,205,13},
        {143,140,138,134,158,174,206,14},
        {142,141,139,135,159,175,207,15},
        {145,146,148,152,128,176,208,16},
        {144,147,149,153,129,177,209,17},
        {147,144,150,154,130,178,210,18},
        {146,145,151,155,131,179,211,19},
        {149,150,144,156,132,180,212,20},
        {148,151,145,157,133,181,213,21},
        {151,148,146,158,134,182,214,22},
        {150,149,147,159,135,183,215,23},
        {153,154,156,144,136,184,216,24},
        {152,155,157,145,137,185,217,25},
        {155,152,158,146,138,186,218,26},
        {154,153,159,147,139,187,219,27},
        {157,158,152,148,140,188,220,28},
        {156,159,153,149,141,189,221,29},
        {159,156,154,150,142,190,222,30},
        {158,157,155,151,143,191,223,31},
        {161,162,164,168,176,128,224,32},
        {160,163,165,169,177,129,225,33},
        {163,160,166,170,178,130,226,34},
        {162,161,167,171,179,131,227,35},
        {165,166,160,172,180,132,228,36},
        {164,167,161,173,181,133,229,37},
        {167,164,162,174,182,134,230,38},
        {166,165,163,175,183,135,231,39},
        {169,170,172,160,184,136,232,40},
        {168,171,173,161,185,137,233,41},
        {171,168,174,162,186,138,234,42},
        {170,169,175,163,187,139,235,43},
        {173,174,168,164,188,140,236,44},
        {172,175,169,165,189,141,237,45},
        {175,172,170,166,190,142,238,46},
        {174,173,171,167,191,143,239,47},
        {177,178,180,184,160,144,240,48},
        {176,179,181,185,161,145,241,49},
        {179,176,182,186,162,146,242,50},
        {178,177,183,187,163,147,243,51},
        {181,182,176,188,164,148,244,52},
        {180,183,177,189,165,149,245,53},
        {183,180,178,190,166,150,246,54},
        {182,181,179,191,167,151,247,55},
        {185,186,188,176,168,152,248,56},
        {184,187,189,177,169,153,249,57},
        {187,184,190,178,170,154,250,58},
        {186,185,191,179,171,155,251,59},
        {189,190,184,180,172,156,252,60},
        {188,191,185,181,173,157,253,61},
        {191,188,186,182,174,158,254,62},
        {190,189,187,183,175,159,255,63},
        {193,194,196,200,208,224,128,64},
        {192,195,197,201,209,225,129,65},
        {195,192,198,202,210,226,130,66},
        {194,193,199,203,211,227,131,67},
        {197,198,192,204,212,228,132,68},
        {196,199,193,205,213,229,133,69},
        {199,196,194,206,214,230,134,70},
        {198,197,195,207,215,231,135,71},
        {201,202,204,192,216,232,136,72},
        {200,203,205,193,217,233,137,73},
        {203,200,206,194,218,234,138,74},
        {202,201,207,195,219,235,139,75},
        {205,206,200,196,220,236,140,76},
        {204,207,201,197,221,237,141,77},
        {207,204,202,198,222,238,142,78},
        {206,205,203,199,223,239,143,79},
        {209,210,212,216,192,240,144,80},
        {208,211,213,217,193,241,145,81},
        {211,208,214,218,194,242,146,82},
        {210,209,215,219,195,243,147,83},
        {213,214,208,220,196,244,148,84},
        {212,215,209,221,197,245,149,85},
        {215,212,210,222,198,246,150,86},
        {214,213,211,223,199,247,151,87},
        {217,218,220,208,200,248,152,88},
        {216,219,221,209,201,249,153,89},
        {219,216,222,210,202,250,154,90},
        {218,217,223,211,203,251,155,91},
        {221,222,216,212,204,252,156,92},
        {220,223,217,213,205,253,157,93},
        {223,220,218,214,206,254,158,94},
        {222,221,219,215,207,255,159,95},
        {225,226,228,232,240,192,160,96},
        {224,227,229,233,241,193,161,97},
        {227,224,230,234,242,194,162,98},
        {226,225,231,235,243,195,163,99},
        {229,230,224,236,244,196,164,100},
        {228,231,225,237,245,197,165,101},
        {231,228,226,238,246,198,166,102},
        {230,229,227,239,247,199,167,103},
        {233,234,236,224,248,200,168,104},
        {232,235,237,225,249,201,169,105},
        {235,232,238,226,250,202,170,106},
        {234,233,239,227,251,203,171,107},
        {237,238,232,228,252,204,172,108},
        {236,239,233,229,253,205,173,109},
        {239,236,234,230,254,206,174,110},
        {238,237,235,231,255,207,175,111},
        {241,242,244,248,224,208,176,112},
        {240,243,245,249,225,209,177,113},
        {243,240,246,250,226,210,178,114},
        {242,241,247,251,227,211,179,115},
        {245,246,240,252,228,212,180,116},
        {244,247,241,253,229,213,181,117},
        {247,244,242,254,230,214,182,118},
        {246,245,243,255,231,215,183,119},
        {249,250,252,240,232,216,184,120},
        {248,251,253,241,233,217,185,121},
        {251,248,254,242,234,218,186,122},
        {250,249,255,243,235,219,187,123},
        {253,254,248,244,236,220,188,124},
        {252,255,249,245,237,221,189,125},
        {255,252,250,246,238,222,190,126},
    };
    
    
    return lookup_table[in_byte][byte_index];
}


// function used to verify that the static bitwise functions have been implemented properly
void test_static_bit_functions()
{
    
    printf("\ntesting...");
    
    for(int test_byte = 0b00000000; test_byte <= 0b11111111; test_byte++)
    {
        for(int test_byte_index = 0; test_byte < 7; test_byte++)
        {
            if(clear_bit(test_byte, test_byte_index) != static_clear_bit(test_byte, test_byte_index))
            {
                printf("\nerror: clear_bit, test_byte: '%d', test_byte_index: '%d'", test_byte, test_byte_index);
            }
            
            if(set_bit(test_byte, test_byte_index) != static_set_bit(test_byte, test_byte_index))
            {
                printf("\nerror: clear_bit, test_byte: '%d', test_byte_index: '%d'", test_byte, test_byte_index);
            }
            
            if(toggle_bit(test_byte, test_byte_index) != static_toggle_bit(test_byte, test_byte_index))
            {
                printf("\nerror: clear_bit, test_byte: '%d', test_byte_index: '%d'", test_byte, test_byte_index);
            }
        }
    }
    
    printf("\ntesting done.");
    
    return;
}